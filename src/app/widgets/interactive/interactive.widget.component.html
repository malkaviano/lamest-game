<div class="card-box">
  <mat-card attr.data-testid="interactive-{{ interactive.id }}">
    <mat-card-title class="card-title">
      {{ interactive.name }}
    </mat-card-title>
    <!-- Mini-bars for HP/EP/AP when available -->
    <div class="mini-bars" *ngIf="hasDerivedAttributes()">
      <div class="bar hp" *ngIf="ratio('CURRENT HP','MAX HP') as hp">
        <div class="fill" [style.width.%]="hp"></div>
        <span class="label">HP</span>
        <span class="value">{{ attrValue('CURRENT HP') }}/{{ attrValue('MAX HP') }}</span>
      </div>
      <div class="bar ep" *ngIf="ratio('CURRENT EP','MAX EP') as ep">
        <div class="fill" [style.width.%]="ep"></div>
        <span class="label">EP</span>
        <span class="value">{{ attrValue('CURRENT EP') }}/{{ attrValue('MAX EP') }}</span>
      </div>
      <div class="bar ap" *ngIf="ratio('CURRENT AP','MAX AP') as ap">
        <div class="fill" [style.width.%]="ap"></div>
        <span class="label">AP</span>
        <span class="value">{{ attrValue('CURRENT AP') }}/{{ attrValue('MAX AP') }}</span>
      </div>
      <div class="status-chips">
        <span class="eng-chip" *ngIf="hasEngagementChip()">ENG</span>
      </div>
    </div>
    <mat-card-content>
      <span [ngSwitch]="interactive.behavior">
        <img matTooltip="{{ retaliateTooltip }}"
          *ngSwitchCase="'RETALIATE'"
          src="assets/icons/shield.png"
          alt="retaliator">
        <img matTooltip="{{ aggressiveTooltip }}"
          *ngSwitchCase="'AGGRESSIVE'"
          src="assets/icons/swords.png"
          alt="aggressor">
        <img matTooltip="{{ playerTooltip }}"
          *ngSwitchCase="'PLAYER'"
          src="assets/icons/person.png"
          alt="player">
      </span>
      <img *ngIf="detectDisguised"
        matTooltip="{{ searchTooltip }}"
        src="assets/icons/search.png"
        alt="disguise breaker">
      <img *ngIf="detectHidden"
        matTooltip="{{ visibilityTooltip }}"
        src="assets/icons/visibility.png"
        alt="stealth breaker">
      <div>
        {{ interactive.description }}
      </div>
    </mat-card-content>
    <mat-card-actions>
      <ng-template ngFor let-action [ngForOf]="actions.items">
          <div class="buttons">
            <button
              class="action-button"
              mat-raised-button color="primary"
              (click)="onActionSelected(action)"
              [disabled]="!canAfford(action) || (cooldownSeconds(action) !== null) || isEngagementBlocked(action)"
              attr.data-testid="actionable-{{ action.name }}"
              matTooltip="{{ setIcon(action.actionable).tooltip }}{{ apTooltipSuffix(action) }}">
              <div class="button-content">
                <img src="{{ setIcon(action.actionable).icon }}"
                  alt="{{ setIcon(action.actionable).tooltip }}" />
                <span class="label">{{ action.label }}</span>
                <span class="ap-pill" *ngIf="apCost(action) > 0">{{ apCost(action) }} AP</span>
                <span class="cd-pill" *ngIf="cooldownSeconds(action) as cd">CD {{ cd }}s</span>
                <span class="eng-pill" *ngIf="isEngagementBlocked(action) && engagementSeconds() as eng">ENG {{ eng }}s</span>
              </div>
            </button>
          </div>
      </ng-template>
    </mat-card-actions>
  </mat-card>
</div>
