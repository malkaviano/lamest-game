<div class="combat-timeline">
  <div class="controls">
    <div class="filters">
      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Filter actor/target</mat-label>
        <input matInput [(ngModel)]="filterText" placeholder="Type a name" />
      </mat-form-field>
      <mat-form-field appearance="outline" class="filter-field short">
        <mat-label>Outcome</mat-label>
        <mat-select [(ngModel)]="filterOutcome">
          <mat-option value="ALL">All</mat-option>
          <mat-option value="HIT">Hit</mat-option>
          <mat-option value="CRIT">Crit</mat-option>
          <mat-option value="HEAL">Heal</mat-option>
          <mat-option value="MISS">Miss</mat-option>
          <mat-option value="DODGE">Dodge</mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field appearance="outline" class="filter-field short">
        <mat-label>Effect</mat-label>
        <mat-select [(ngModel)]="filterEffect">
          <mat-option value="ALL">All</mat-option>
          <mat-option value="KINETIC">Kinetic</mat-option>
          <mat-option value="FIRE">Fire</mat-option>
          <mat-option value="ACID">Acid</mat-option>
          <mat-option value="PROFANE">Profane</mat-option>
          <mat-option value="SACRED">Sacred</mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <span class="spacer"></span>
    <button mat-stroked-button color="warn" (click)="clear()">Clear</button>
  </div>
  <div class="list" *ngIf="displayed.items.length; else empty">
    <div
      class="event"
      *ngFor="let ev of displayed.items; index as i"
      (click)="onHighlight(ev)"
      [attr.data-testid]="'combat-event-' + i"
    >
      <span class="icon">{{ iconFor(ev) }}</span>
      <div class="body">
        <div class="line">
          <span class="actor">{{ ev.actorName }}</span>
          <span class="arrow">â†’</span>
          <span class="target">{{ ev.targetName }}</span>
        </div>
        <div class="meta">
          <ng-container [ngSwitch]="ev.outcome">
            <span *ngSwitchCase="'HIT'" class="amount damage"
              >-{{ ev.amount }}</span
            >
            <span *ngSwitchCase="'CRIT'" class="amount crit"
              >-{{ ev.amount }}</span
            >
            <span *ngSwitchCase="'HEAL'" class="amount heal"
              >+{{ ev.amount }}</span
            >
            <span *ngSwitchCase="'MISS'" class="tag miss">Miss</span>
            <span *ngSwitchCase="'DODGE'" class="tag dodge">Dodge</span>
            <span *ngSwitchDefault class="tag">{{ ev.outcome }}</span>
          </ng-container>
          <span *ngIf="effectBadge(ev)" class="badge">{{
            effectBadge(ev)
          }}</span>
        </div>
      </div>
    </div>
  </div>

  <ng-template #empty>
    <div class="empty">No combat events yet.</div>
  </ng-template>
</div>
